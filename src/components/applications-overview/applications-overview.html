<section ng-if="ctrl.pageReady" class="page-container--override">
    <div class="page-header">
        <div class="row">
            <nav class="gf-tabs col-lg-6 col-md-12">
                <div class="gf-tabs-item"><a class="gf-tabs-link" target="_self" href="plugins/devopsprodigy-kubegraf-app/page/cluster-status?clusterName={{ctrl.cluster.name}}">Cluster Status</a></div>
                <div class="gf-tabs-item"><a class="gf-tabs-link active" target="_self" href="plugins/devopsprodigy-kubegraf-app/page/applications-overview?clusterName={{ctrl.cluster.name}}">Applications Overview</a></div>
                <div class="gf-tabs-item"><a class="gf-tabs-link" target="_self" href="plugins/devopsprodigy-kubegraf-app/page/nodes-overview?clusterName={{ctrl.cluster.name}}">Nodes Overview</a></div>
            </nav>
            <div class="header-btn col-lg-6 col-md-12" ng-if="ctrl.isAdmin">
                <a class="btn btn-secondary timepicker-rangestring" target="_self" ng-href="{{ctrl.version < 6 ? 'plugins/devopsprodigy-kubegraf-app/edit' : 'plugins/devopsprodigy-kubegraf-app/'}}">
                    Plugin Config
                </a>
                <a class="btn btn-secondary" href="plugins/devopsprodigy-kubegraf-app/page/cluster-config?clusterId={{ctrl.cluster.id}}" target="_self">
                    Edit
                </a>
                <a class="btn btn-secondary timepicker-rangestring" href="plugins/devopsprodigy-kubegraf-app/?page=dashboards">
                    Dashboards
                </a>
            </div>
        </div>
        <div class="hr"></div>
    </div>
    <div class="page-body--override">
        <div class="overview-panel">
            <div class="header">
                <div class="title">
                    <span class="chevron"></span>
                    <h1>Overview: <span ng-bind="ctrl.cluster.name"/>. Applications</h1>
                </div>
                <div class="overview-panel_btn">
                    <span class="namespace-counter" ng-if="ctrl.namespaceMapReady">
                        <span class="active">{{ ctrl.namespaceActiveCount() }}</span> / {{ ctrl.namespaceCount() }}
                    </span>
                    <span class="vertical-line"></span>
                    <span class="btn btn-secondary" ng-click="ctrl.__showAll()">Show all</span>
                    <span class="btn btn-secondary" ng-click="ctrl.__hideAll()" data-toggle="tooltip"
                          title="Use Ctrl+Click or âŒ˜+Click to select only one Namespace"
                          data-placement="bottom" bs-tooltip=""
                    >Hide all&nbsp;&nbsp;<span class="gicon gicon-question card-item-label"></span></span>
                </div>
            </div>
            <div class="overview-panel_body">
                <div class="overview-panel_body_components">
                    <h2>Components</h2>
                    <div class="component" ng-repeat="component in ctrl.storeComponents | orderBy: 'name'">
                        <span class="status-indicator" ng-class="{red:component.status, green:!component.status}"></span>
                        <span ng-bind="component.name" bs-tooltip="component.message" data-placement="right"></span>
                    </div>
                </div>
                <div class="overview-panel_body_namespaces" ng-if="ctrl.namespaceMapReady">
                    <div class="checkbox" ng-repeat="(npKey, namespace) in ctrl.namespaceMap">
                        <input type="checkbox"
                               id="checkbox-{{npKey}}"
                               ng-click="ctrl.namespaceClick($event, namespace)"
                               ng-checked="namespace.open">
                        <span class="gf-form-switch__checkbox"></span>
                        <label for="checkbox-{{npKey}}" ng-bind="namespace.name"></label>
                    </div>
                </div>
            </div>
        </div>
        <div ng-if="ctrl.namespaceMapReady">
            <section ng-if="ctrl.getWarningPods().length > 0">
                <div class="row">
                    <div class="col-md-6">
                        <div class="markdown-html explore-panel">
                            <table style="width: 100%">
                                <tr>
                                    <th>Status</th>
                                    <th>Pod Name</th>
                                    <th>Error message </th>
                                    <th ng-show="ctrl.hideAllWarningPods">
                                        <div class="btn btn-danger override--full-width" ng-click="ctrl.toggleAllWarningPods()"> <span class="btn gicon gicon-alert-alt"></span><span ng-bind="'show all warnings('+ctrl.getWarningPods().length+')'"></span></div>
                                    </th>
                                </tr>
                                <tr ng-repeat="pod in ctrl.getWarningPods()" ng-hide="ctrl.hideAllWarningPods">
                                    <td>
                                        <span class="override--nodeTable_status override--pod_status_{{pod.color}}"></span>
                                    </td>
                                    <td class="pointer" ng-click="ctrl.goTo(pod.name)">
                                        <span ng-bind="pod.name"></span>
                                        <span>
                                        <a href="{{ctrl.getPodDashboardLink(pod)}}" target="_blank" style="color: #ffffff">
                                            <i class="fa fa-eye"/>
                                        </a>
                                    </span>
                                    </td>
                                    <td ng-bind="pod.message"></td>
                                </tr>
                            </table>
                            <div
                                    class="btn btn-secondary override--full-width"
                                    ng-click="ctrl.toggleAllWarningPods()"
                                    ng-hide="ctrl.hideAllWarningPods"
                            >
                                <span class="btn gicon gicon-alert-alt"></span>hide all warnings(<span ng-bind="ctrl.getWarningPods().length"></span>)
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <div class="namespace-panel" ng-repeat="(npKey, namespace) in ctrl.namespaceMap" ng-show="namespace.open">
                <div class="header">
                    <div class="title">
                        <span class="chevron"></span>
                        <h1>Namespace: <span ng-bind="namespace.name"/></h1>
                    </div>
                    <div class="status">Status: <span ng-bind="namespace.data.status.phase"/></div>
                </div>
                <div class="namespace-panel_body">
                    <div class="column" ng-repeat="col in ctrl.columnNames">
                        <div class="column_header">
                            <h3 ng-bind="col.colName"></h3>
                        </div>
                        <div ng-if="ctrl.namespaceFilterIsDeleted(namespace[col.nsKey]).length === 0" class="column_cell">
                            <h4 class="column_cell_header">
                                No data
                            </h4>
                        </div>
                        <div ng-repeat="key in ctrl.namespaceFilterIsDeleted(namespace[col.nsKey])" class="column_cell">
                            <h4 class="column_cell_header" ng-click="key.toggle()">
                                <span ng-bind="key.name"/>
                                <span ng-if="col.nsKey === 'deployments' || col.nsKey === 'daemonsets' || col.nsKey === 'statefulsets'">
                                    <a href="{{ctrl.getEntityDashboardLink(key, col.nsKey)}}" target="_blank">
                                        <i class="fa fa-eye"/>
                                    </a>
                                </span>
                            </h4>
                            <div ng-repeat="pod in key.pods | limitTo: key.limit" class="pod"
                                 ng-if="!pod.is_deleted" bs-tooltip="pod.message" data-placement="bottom">
                                    <span class="status-indicator {{pod.color}}"></span>
                                    <span class="pod_title">
                                        {{pod.name}}&nbsp;<a href="{{ctrl.getPodDashboardLink(pod)}}" target="_blank"><i class="fa fa-eye"></i></a>
                                    </span>
                                </div>
                            <div ng-if="col.nsKey === 'cronJobs'" ng-repeat="job in key.jobs | limitTo: key.limit">
                                <div class="card-item-label"
                                     ng-repeat="pod in job.pods"
                                     ng-if="!pod.is_deleted"
                                     bs-tooltip="pod.message" data-placement="bottom"
                                >
                                    <li class="explore-toolbar-item">
                                        <span class="override--pod_status override--pod_status_{{pod.color}}"/>
                                        <span ng-bind="pod.name" class="{{pod.name}} pointer"/>
                                        <span>
                                        <a href="{{ctrl.getPodDashboardLink(pod)}}" target="_blank">
                                            <i class="fa fa-eye"/>
                                        </a>
                                    </span>
                                    </li>
                                </div>
                            </div>
                            <span class="btn btn-secondary explore-panel" ng-if="key.pods.length > key.limit"
                                ng-hide="key.limit === false" ng-click="key.showAllPods()">
                                show more pods
                            </span>
                            <div ng-if="key.services.length > 0" class="services">
                                <h5>Services</h5>
                                <div class="service" ng-repeat="service in key.services">
                                    <span class="dot-grey"></span>
                                    <span class="service_title">
                                        {{ service.name }}:
                                        <span ng-repeat="port in service.data.spec.ports">
                                            {{ port.port }}/{{ port.protocol }}
                                        </span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
